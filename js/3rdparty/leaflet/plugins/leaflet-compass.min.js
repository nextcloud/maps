/* 
 * Leaflet Control Compass v0.0.1 - 2014-07-13 
 * 
 * Copyright 2014 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demos: 
 * http://labs.easyblog.it/maps/leaflet-compass/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-compass.git 
 * 
 */
(function(){L.Control.Compass=L.Control.extend({includes:L.Mixin.Events,options:{autoActive:!0,textErr:null,callErr:null,position:"topright"},initialize:function(a){a&&a.style&&(a.style=L.Util.extend({},this.options.style,a.style)),L.Util.setOptions(this,a),this._errorFunc=this.options.callErr||this.showAlert,this._isActive=!1,this._firstMoved=!1,this._currentAngle=null},onAdd:function(a){this._map=a;var b=L.DomUtil.create("div","leaflet-compass");return this._button=L.DomUtil.create("a","compass-button",b),this._button.href="#",this._divcompass=L.DomUtil.create("div","compass-icon",this._button),this._divcompass.src="images/compass-icon.png",L.DomEvent.on(this._button,"click",L.DomEvent.stop,this).on(this._button,"click",this._switchCompass,this),this._alert=L.DomUtil.create("div","compass-alert",b),this._alert.style.display="none",this._map.on("anglefound",this._rotateCompass,this).on("angleerror",this._errorCompass,this),this.options.autoActive&&this.activate(),b},onRemove:function(){this.deactivate()},_switchCompass:function(){this._isActive?this.deactivate():this.activate()},getAngle:function(){return this._currentAngle},activate:function(){this._isActive=!0,this._divcompass.style.display="block";var a=this;window.addEventListener("deviceorientation",function(b){a._rotateCompass(b.webkitCompassHeading)},!1),this.fire("compass_activated")},_rotateCompass:function(a){a=360-a,this._divcompass.style.webkitTransform="rotate("+a+"deg)",this._currentAngle=a,this.fire("compasslocated",{angle:a}),L.DomUtil.addClass(this._button,"active")},_errorCompass:function(a){this.deactivate(),this._errorFunc.call(this,this.options.textErr||a.message)},deactivate:function(){this._isActive=!1,this._firstMoved=!1,L.DomUtil.removeClass(this._button,"active"),this.fire("compass_deactivated")},showAlert:function(a){this._alert.style.display="block",this._alert.innerHTML=a;var b=this;clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){b._alert.style.display="none"},2e3)}}),L.control.compass=function(a){return new L.Control.Compass(a)}}).call(this);